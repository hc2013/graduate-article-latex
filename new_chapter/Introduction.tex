\chapter{引言}

\section{项目背景}
轨迹数据指的是运动实体在空间中所经过点的集合，包括交通工具运动轨迹，人类活动的轨迹，动物季节性迁徙的轨迹等等\cite{GaoQiang2017}。每时每刻都在发生的事情实际上都在产生各自相应的轨迹数据\cite{JiGenLin2015}。这些数据在技术不成熟的过去几乎都被忽略掉了，而在移动互联网和卫星定位技术高速发展成熟的今天，稳定地捕获、记录、存储轨迹数据成为了可能。这为基于海量轨迹数据的商业分析应用奠定了基础。

当前，轨迹大数据已成为数据挖掘和地理空间数据提取等领域最有潜力的发展方向\cite{YangWei2016}。海量的轨迹数据潜在性地暴露了实体的活动特征、行为倾向和环境关系等信息
\cite{YuanGuan2012}。 这些细节信息的暴露，很大程度上是由于轨迹数据本身存在位置特征和时空特征上的关联性，这种关联性蕴藏着巨大的商业价值。而在所有这些的关联性中，最直观，最有商用价值的，就是轨迹的相似性。

与轨迹相似性有关的高价值应用场景很多，例如基于轨迹相似的用户分类，交通路线预测，犯罪同伙分析等等。因此，一个稳定高效的，支持轨迹数据相似检索和索引更新的轨迹数据系统是符合商业发展要求的必需产品。而要构建这样一个轨迹数据系统，必需考虑以下三个方面的问题。

第一，海量轨迹的存储。轨迹本身是具有时空特性的几何图形，而轨迹数据的量级一般都在千万级甚至亿级以上。这对于轨迹数据存储提出了很高的要求，传统的关系型数据库对于轨迹数据的存储和查询存在明显的性能瓶颈\cite{WangKai2017}。因此以什么样的结构存储轨迹数据是首先要考虑的重要问题。

第二，检索的数据结构和检索行为的定义。由于数据量很大，传统的预处理、排序、过滤等方法即使发挥到最大效应，也很难提供让用户满意的检索性能。因此，必须为轨迹数据建立定制的索引结构，并根据这种索引结构定义检索行为，才能让检索性能满足商用需求\cite{GongJun2015}。

第三，可视化运行。在当今大数据行业的发展背景下，数据可视化几乎是所有商业用户的共同需求。数据可视化很大程度上降低了系统的使用门槛，提高了系统的可用性，扩大了系统的适用范围\cite{ChenJianjun2001}。而在地理轨迹数据系统的应用场景下，需要可视化的，除了轨迹数据之外，地图数据也必须要实现可视化\cite{WuXiujun2008}，否则的话，只有轨迹数据，没有其在对应地图上的状态显示，轨迹本身失去了空间特性，退化为简单的几何图形，那么轨迹可视化本身也失去了意义。因此轨迹+地图的展示模式，才是一个完整的轨迹数据服务的可视化模式。

针对以上三个方面问题，本文设计并实现了基于优先点树和地图瓦片的地理轨迹数据服务，为用户提供高效，稳定的轨迹相关功能服务。
\section{国内外相关系统的发展概况}

\subsection{国内(外)轨迹数据系统发展概况}
目前国内外轨迹相关系统所提供的轨迹分析功能着重于时空速度变化的捕获和分析，本文主要调查了百度鹰眼和ArcGis这两个比较成熟的系统。

百度鹰眼是一个开放的轨迹数据服务，它支持轨迹追踪，存储，运算和查询等功能，可帮助开发者管理百万级别的人类运动轨迹\cite{BaiduYingyanApp}。
百度鹰眼所支持的持续轨迹追踪功能是由鹰眼SDK提供的。鹰眼SDK可以实时地获取移动终端的空间地理位置，并持续回传轨迹数据，采集回传的频率一般在2s到5min这个区间内。轨迹回传的频率越高，对轨迹数据的完整性保留越好，轨迹数据越贴近真实。

百度鹰眼支持海量轨迹的存储，它提供了轨迹数据访问隔离和分布式存储，能够有效地保证数据安全。支持存储的内容包括坐标、速度、图片、视频和用户自定义字段等。在数据存储量上，百度鹰眼目前支持100 万终端，储存1 年的轨迹数据\cite{BaiduYingyan}。

除了轨迹跟踪和存储之外，百度鹰眼还支持轨迹查询和展示功能。开发者可以很低延时地查询到终端的实时位置或者历史轨迹，并可以选择性地对历史轨迹进行回放。

最后，百度鹰眼支持轨迹数据分析功能。目前已提供的轨迹分析功能有驾驶行为分析，具体包括驾驶急速和超速判断，违法停车行为评估等方面。这些分析功能主要针对轨迹时间特性和速度特性提供服务。

ArcGis是由美国ESRI公司开发的地理信息系统系列软件，严格地讲，ArcGis1.0是世界上第一个现代意义上的，商业化的GIS软件。在轨迹数据服务方面ArcGis 提供了路径图层创建，障碍创建，停靠点编辑，轨迹运动方向生成，运动轨迹展示，轨迹运动分析等功能。其中轨迹运动分析包括所有停靠点最佳访问方式路径生成和展示。

综上可知，目前针对轨迹相似性的相关分析功能，在国内外已有系统中并不成熟和完备。

\subsection{国内（外）地图瓦片数据系统发展概况}
TileServer-GL是一个针对地图瓦片数据的开源地图服务器。它能够在服务器端使用MapBox GL内置引擎对矢量瓦片进行栅格化，进而为web应用和移动应用提供地图数据。它支持Mapbox GL JS,Android SDK,IOS SDK,Leaflet, OpenLayers, HighDPI/Retina, GIS via WMTS等众多前端库的数据调用\cite{TileServerGL}。

TileServer-GL不仅能够提供地图瓦片数据，还提供了基于Mapbox GL Style的地图风格渲染。用户只要提供了有效的Mapbox GL style文件，TileServer就能够按照指定风格渲染地图数据，并返回给浏览器或移动端。

尽管TileServer-GL拥有代码开源，部署方便，使用简单等优点，但是它在商业应用领域存在以下两方面明显的短板。

首先，它的数据是保存在mbtiles文件中，而mbtiles是sqlite数据库的一种文件格式。TileServer-GL强耦合了这种数据库文件格式使得其对不同数据源缺乏扩展性，面对那些数据保存在传统关系型数据库或是列数据库中的用户，TileServer-GL将无能为力。

其次，TileServer-GL只能提供瓦片读取服务，而不能提供地图数据的实时动态更新，也就是说，整个服务从始至终都是无状态的。而在某些商业场景下，地图数据发生更新变化的可能性是非常大的。对于这种有更新要求的商业场景,TileServer也无法胜任。

综上可知，TileServer-GL能力有限，不能应用于本文所述的地理轨迹数据服务的实现中。
\section{本文的主要工作}
本文设计和实现了基于优先点树和地图瓦片的地理轨迹数据服务，其核心功能包括针对千万级别的轨迹数据的索引建立，相似轨迹的检索和新轨迹数据的插入，地图可视化以及地图数据更新等。本文主要工作有以下两个方面。

第一，设计和实现了Lucene Geometry vp-tree这个索引结构，也就是优先点树索引结构。这个数据结构是原生Lucene没有的。其主要功能是在JTS Geometry数据之上，建立一个多分查找的树结构，以最大限度地做到搜索剪枝，将搜索时间控制在nlog(n)这个级别上。同时，为了满足用户使用场景中对索引本身的更新和初始化需求，本文还设计和实现了优先点树索引的初始化建树和插入新的轨迹数据的功能。

第二，设计和实现了地图瓦片服务Map Tile Service(简称MTS)。MTS是一个提供了瓦片读取和更新的地图瓦片服务器，能够为OpenLayer、Leaflet、GIS via wmts 等多个前端库提供瓦片数据。相比于开源的TileServer-GL，MTS不仅能够提供地图更新功能，还具有良好的数据扩展性，提供多种数据存储方式的支持，能够实现与多种数据库的无缝功能对接。

\section{本文的组织结构}
本文的组织结构如下：

第一章\ 引言。介绍了项目背景和国内外相关系统的研究现状。

第二章\ 相关技术概念综述。介绍了项目中使用到的优先点树结构、lucene引擎结构与原理、地图瓦片相关概念、nodejs express框架、MapBox标准等相关技术概念。

第三章\ 系统需求分析与概要设计。通过需求列表分别展示了两个主要子服务的功能需求和非功能需求，通过用例图介绍了需求分析的结果，并针对重要的，操作复杂的用例使用用例描述表进行重点介绍。还通过软件架构4+1模型对整个项目进行了概要设计。

第四章\ 轨迹数据子服务详细设计与实现。在概要设计的基础上，对轨迹数据子服务进行详细设计并阐述具体的设计细节，以类图展示了类关系，以流程图和示意图介绍算法实现思路，并展示了关键部分代码和相似轨迹检索功能的运行效果图。

第五章\ 地图瓦片数据子服务详细设计与实现。在概要设计的基础上，对地图瓦片数据子服务进行详细设计并阐述具体的设计细节，以类图展示了类关系，以流程图和示意图介绍算法实现思路，并展示了关键部分代码。

第六章\ 系统测试。介绍了整个服务的测试环境，测试数据以及单元测试，功能测试，性能测试的情况，以测试列表描述测试方法和过程，以折线图和条状图描述测试结果。

第七章\ 总结与展望。总结论文期间所做的工作，并就轨迹数据服务的未来方向作了进一步展望。

\section{本章小结}
本章首先介绍了项目背景，阐述了建立地理轨迹数据服务的价值和必要性，以及主要面临的技术问题和挑战。随后介绍了国内外相关系统的发展情况，包括百度鹰眼、ArcGis和TileServer-GL，指出了这些已有系统的优势和不足，分析了地理轨迹数据服务需要解决的需求点。最后介绍了本文的组织结构，包括各个章节的主要内容和行文思路。
