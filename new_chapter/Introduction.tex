\chapter{引言}

\section{项目背景}
在移动互联网、卫星定位技术、LBS技术高速发展的背景下，无时无刻不在产生轨迹数据，轨迹数据包括交通数据、人类移动数据、动物迁移数据和自然现象轨迹数据等。海量的轨迹数据潜在性地暴露了个人的行为特征、兴趣爱好和社会关系等信息。\cite{GaoQiang2017}这种细节信息的暴露，很大程度上是由于轨迹数据本身存在位置特征和时空特征上的关联性。这种关联性是很多高价值商业场景的运行基础。而在所有这些的关联性中，最直观，最有利用价值的，就是轨迹的相似性。

与轨迹相似有关的高价值应用场景很多，例如基于轨迹相似的用户分类，交通路线预测，犯罪同伙分析等等。因此，一个稳定高效的，实现轨迹数据相似检索和索引更新的轨迹数据系统是符合商业发展要求的必需产品。而要构建这样一个相似轨迹检索系统，必需考虑以下三个方面的问题。

第一，海量轨迹的存储。轨迹本身是具有时空特性的几何图形，而轨迹数据的量级一般都在千万级甚至亿级以上。这对于数据存储提出了很高的要求，传统的单机关系型数据库显然无法满足这一要求。

第二，检索的数据结构和检索行为的定义。由于数据量很大，传统的预处理，排序，过滤等方法即使发挥到最大效应，也很难提供让用户满意的检索性能。因此，必须为轨迹数据建立定制的索引结构，并根据这种索引结构定义检索行为，才能在检索性能满足商用需求。

第三，可视化运行。在当今大数据行业的发展背景下，数据可视化几乎是所有商业用户的共同需求。数据可视化很大程度上降低了系统的使用门槛，提高了系统的可用性，扩大了系统的适用范围。而在轨迹相似检索系统下，需要可视化的数据包括两部分。除了轨迹数据之外，地图数据也必须要实现可视化。否则的话，只有轨迹数据，没有其在对应地图上的状态显示，那轨迹本身失去了空间特性，退化为简单的几何图形，那么轨迹可视化本身也失去了意义。因此轨迹+地图的展示模式，才是一个完整的轨迹数据服务的可视化模式。

针对以上三个方面问题，本文设计并实现了基于优先点树和地图瓦片的轨迹数据服务，为用户提供高效，稳定的轨迹相关功能服务。
\section{国内外相关系统的发展概况}

\subsection{国内(外)轨迹数据系统发展概况}
目前国内外轨迹相关系统所提供的轨迹分析功能着重于对速度变化和停靠点处理两方面，本文主要调查了百度鹰眼和ArcGis这两个系统。

百度鹰眼是一套集轨迹追踪、存储、运算、查询的完整轨迹开放服务，可帮助开发者管理多达100万人/车轨迹。\cite{BaiduYingyan}

百度鹰眼支持持续的轨迹追踪，鹰眼SDK可以实时地采集终端的地理位置，持续回传轨迹。其采集回传的频率一般在2s到5min这个区间内。

百度鹰眼支持轨迹存储，提供数据访问隔离和分布式存储，保证数据安全。其存储的内容包括坐标，速度，图片，视频和用户自定义字段。在数据存储量上，鹰眼目前支持100万终端，储存1年的轨迹数据。

百度鹰眼支持轨迹查询和展示，提供历史轨迹查询服务，开发者可以毫无延时地查询终端的实时位置，并回放轨迹。

百度鹰眼支持轨迹数据分析。目前已提供的轨迹分析包括驾驶行为分析（急速，超速判断），停留点分析（是否违法停车）等。

ArcGis是由ESRI公司开发的地理信息系统系列软件，其ArcGis1.0是世界上第一个现代意义上的GIS软件，第一个商品化的GIS软件。在轨迹数据服务方面ArcGis提供了路径图层创建，障碍创建，停靠点编辑，轨迹运动方向生成，运动轨迹展示，轨迹运动分析。其中轨迹运动分析包括所有停靠点最佳访问方式路径生成和展示。

\subsection{国内（外）地图瓦片数据系统发展概况}
TileServer-GL是一个针对地图瓦片数据的开源地图服务器。它能够在服务器端使用MapBox GL内置引擎对矢量瓦片进行栅格化，进而为web应用和移动应用提供地图数据。它支持Mapbox GL JS,Android SDK,IOS SDK,Leaflet, OpenLayers, HighDPI/Retina, GIS via WMTS等众多前端库的数据调用。\cite{TileServerGL}

TileServer-GL不仅能够提供瓦片数据，还提供了基于Mapbox GL Style的地图渲染。用户只要提供了有效的Mapbox GL style文件，TileServer就能够按照指定风格渲染地图数据，并返回给浏览器或移动端。

尽管TileServer-GL对外服务有良好的适应性，但是它在商业应用领域存在以下两方面明显的短板。

首先，它的数据是保存在mbtiles文件中，而mbtiles是sqlite数据库的一种文件格式。TileServer-GL强耦合了这种文件格式使得其对不同数据源的扩展性几乎为零，面对那些数据保存在传统关系型数据库或是列数据库中的用户，TileServer-GL将无能为力。

其次，TileServer-GL只能提供瓦片读取服务，而不能提供地图数据的实时动态更新。而某些商业场景下，地图数据发生更新变化的可能性是非常大的。对于这种有更新要求的商业场景,TileServer也无法胜任。
\section{本文的主要工作}
本文设计和实现了基于优先点树和地图瓦片的轨迹数据服务，其核心功能是在千万级别的轨迹数据量中，在规定时间内检索出与目标轨迹最相似的K条轨迹，并将这些轨迹可视化地展示在地图背景之下。主要工作有以下两个方面。

第一，设计和实现了Lucene Geometry vp-tree这个索引结构，也就是优先点树结构。这个数据结构是原生Lucene没有的。其主要功能是在JTS Geometry数据之上，建立一个多分查找的树结构，以最大限度地做到搜索剪枝，将搜索时间控制在nlog(n)这个级别上。本文还设计和实现了优先点树的初始化建树和插入新的轨迹数据等功能。

第二，设计和实现了地图瓦片服务Map Tile Service(简称MTS)。MTS是一个提供了瓦片读取，检索，更新和风格渲染功能的地图瓦片服务器，能够为OpenLayer,Leaflet，GIS via wmts 等多个前端库提供瓦片数据。相比于开源的TileServer-GL，MVTS能够提供地图更新功能，并且具有良好的数据扩展性，提供多种数据存储方式的支持，能够实现与多种数据库的无缝功能对接。

\section{本文的组织结构}
本文的组织结构如下：

第一章\ 引言部分。介绍了项目背景，国内外相关系统的研究现状。

第二章\ 技术综述。介绍了项目中使用到的优先点树结构，lucene引擎，瓦片数据，nodejs express框架，MapBox标准等相关技术概念。

第三章\ 系统需求分析和概要设计。通过需求列表展示了项目的功能需求和非功能需求，通过用例图介绍了需求分析的结果，并针对重要的，操作复杂的用例使用用例描述表进行重点介绍。还对项目进行了概要设计，以组件图介绍整体架构，并介绍了各个子服务的功能和作用以及子服务之间的相互关系。

第四章\ 轨迹数据服务详细设计与实现。在概要设计的基础上，对轨迹数据服务进行详细设计并阐述具体的设计细节，以类图展示了类关系，以流程图介绍算法实现思路，并展示了关键部分代码。

第五章\ 地图瓦片数据服务详细设计与实现。在概要设计的基础上，对地图瓦片数据服务进行详细设计和具体的设计细节，以类图展示了类关系，以流程图介绍算法实现思路，并展示了关键部分代码，最后还展示了整个系统可视化运行的效果图。

第五章\ 总结与展望。总结论文期间所做的工作，并就轨迹数据服务的未来方向作了进一步展望。
